<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maître du Jeu - Malakoff Quiz</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<body>
    <!-- Panneau d'informations permanent (code partie + joueurs) -->
    <aside id="gameInfoPanel" class="game-info-panel" style="display: none;">
        <div class="panel-code-display">
            <h3>Code de la partie</h3>
            <div class="game-code-number" id="panelGameCode">----</div>
        </div>
        <div class="players-status-section">
            <h3>Joueurs <span class="player-counter">(<span id="panelPlayerCount">0</span>)</span></h3>
            <div id="panelPlayersList" class="players-status-list">
                <p class="empty-state">Aucun joueur</p>
            </div>
        </div>
        <button id="interruptGameBtn" class="btn btn-danger btn-sm" style="margin-top: auto; width: 100%;">
            <i class="ph ph-pause-circle"></i> Interrompre la partie
        </button>
    </aside>

    <div class="container">
        <!-- ÉCRAN 1 : Configuration de la partie -->
        <div id="setupScreen" class="screen active">
            <div class="setup-header">
                <h1>Configuration de la partie</h1>
                <button id="restoreGameBtn" class="btn btn-secondary btn-sm"><i class="ph ph-arrows-clockwise"></i>
                    Reprendre une partie</button>
            </div>
            <p>Sélectionnez les questions pour votre quiz</p>

            <div class="setup-layout">
                <!-- COLONNE GAUCHE : Ordre des manches -->
                <div class="setup-column-left">
                    <div id="mancheOrderControl" class="manche-order-container">
                        <!-- Chargé dynamiquement par displayMancheOrderControl() -->
                    </div>
                </div>

                <!-- COLONNE DROITE : Liste des questions -->
                <div class="setup-column-right">
                    <div class="select-all-container">
                        <input type="checkbox" id="selectAllCheckbox">
                        <label for="selectAllCheckbox"><strong>Tout sélectionner</strong></label>
                    </div>

                    <div id="questionsSelection" class="questions-list">
                        <!-- Chargé dynamiquement via JS -->
                    </div>
                </div>
            </div>

            <button id="createGameBtn" class="btn btn-primary" style="margin-top: 20px;">Créer la partie</button>
        </div>

        <!-- ÉCRAN 2 : Salle d'attente -->
        <div id="waitingScreen" class="screen">
            <div class="game-code-display">
                <h2>Code de la partie</h2>
                <div id="gameCode" class="code">----</div>
                <p>Communiquez ce code aux joueurs</p>
            </div>

            <div class="players-waiting">
                <h3>Joueurs connectés (<span id="playerCount">0</span>)</h3>
                <div id="playersList" class="players-list">
                    <p class="empty-state">En attente des joueurs...</p>
                </div>
            </div>

            <button id="startGameBtn" class="btn btn-primary" disabled>Lancer la partie</button>
        </div>

        <!-- ÉCRAN 3 : Question en cours -->
        <div id="questionScreen" class="screen">
            <div class="game-header">
                <div class="game-info">
                    <span>Code: <strong id="currentGameCode">----</strong></span>
                    <span>Question <span id="questionNumber">1</span>/<span id="totalQuestions">10</span></span>
                    <span><i class="ph ph-clock"></i> <span id="timer">20</span>s</span>
                </div>
            </div>

            <!-- Affichage de la manche -->
            <div id="mancheDisplay" class="manche-display" style="display:none;">
                <span class="manche-icon"><i class="ph ph-target"></i></span>
                <span class="manche-name">Manche: <strong id="mancheName">-</strong></span>
            </div>

            <div class="question-display">
                <h2 id="questionText">Question...</h2>

                <!-- Pour QCM -->
                <div id="qcmChoices" class="choices" style="display:none;">
                    <!-- Chargé dynamiquement -->
                </div>

                <!-- Pour Vrai/Faux -->
                <div id="vraiFauxChoices" class="choices" style="display:none;">
                    <!-- Chargé dynamiquement -->
                </div>

                <!-- Réponse correcte (visible uniquement pour le maître) -->
                <div id="correctAnswer" class="correct-answer">
                    Bonne réponse : <strong id="correctAnswerText">-</strong>
                </div>
            </div>

            <div class="responses-section">
                <h3>Réponses des joueurs (<span id="responsesCount">0</span>/<span id="totalPlayersCount">0</span>)</h3>
                <div id="responsesList" class="responses-list">
                    <!-- Chargé dynamiquement -->
                </div>
            </div>

            <button id="revealResultsBtn" class="btn btn-success" style="display:none;"><i class="ph ph-mask-happy"></i>
                Révéler les résultats</button>
            <button id="showLeaderboardBtn" class="btn btn-primary" style="display:none; margin-top: 10px;"><i
                    class="ph ph-chart-bar"></i> Afficher le classement</button>
        </div>

        <!-- ÉCRAN 4 : Classement -->
        <div id="leaderboardScreen" class="screen">
            <h1>Classement</h1>
            <div id="leaderboardContent" class="leaderboard">
                <!-- Chargé dynamiquement -->
            </div>

            <button id="nextQuestionBtn" class="btn btn-primary">Question suivante</button>
            <button id="viewHistoryBtn" class="btn btn-secondary"><i class="ph ph-clipboard-text"></i> Voir
                l'historique</button>
        </div>

        <!-- ÉCRAN 5 : Fin de partie -->
        <div id="finishedScreen" class="screen">
            <h1><i class="ph ph-trophy"></i> Partie terminée !</h1>
            <div id="finalLeaderboard" class="leaderboard">
                <!-- Chargé dynamiquement -->
            </div>

            <div class="final-actions">
                <button onclick="location.reload()" class="btn btn-primary">Nouvelle partie</button>
                <button onclick="location.href='/'" class="btn btn-secondary">Retour à l'accueil</button>
            </div>
        </div>

        <!-- ÉCRAN 5 : Reprendre une partie -->
        <div id="restoreScreen" class="screen">
            <h1><i class="ph ph-arrows-clockwise"></i> Reprendre une partie</h1>
            <div class="history-header">
                <button id="backFromRestore" class="btn btn-secondary">← Retour</button>
            </div>
            <p id="restoreGameMessage">Chargement des parties actives...</p>
            <div id="activeGamesList" class="active-games-list">
                <!-- Liste des parties actives chargée dynamiquement -->
            </div>
        </div>

        <!-- ÉCRAN 6 : Historique des questions -->
        <div id="historyScreen" class="screen">
            <h1><i class="ph ph-clipboard-text"></i> Historique des questions</h1>
            <div class="history-header">
                <button id="backFromHistory" class="btn btn-secondary">← Retour</button>
            </div>
            <p class="history-instruction">
                <i class="ph ph-info"></i> Cliquez sur une question pour voir les détails et modifier les validations des réponses
            </p>

            <div id="historyList" class="history-list">
                <!-- Liste des questions chargée dynamiquement -->
            </div>

            <!-- Modal pour les détails d'une question -->
            <div id="questionDetailsModal" class="modal" style="display:none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="modalQuestionTitle">Question</h2>
                        <button id="closeModal" class="btn-close">×</button>
                    </div>
                    <div class="modal-body">
                        <div id="modalQuestionText" class="question-detail"></div>
                        <div id="modalResponsesList" class="responses-list">
                            <!-- Réponses chargées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="js/host.js"></script>
</body>

</html>